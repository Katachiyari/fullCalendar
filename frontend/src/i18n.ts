import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'

const STORAGE_KEY = 'opshub_lang'

function initialLang() {
  const saved = localStorage.getItem(STORAGE_KEY)
  if (saved === 'fr' || saved === 'en') return saved
  const nav = (navigator.language || 'fr').toLowerCase()
  return nav.startsWith('en') ? 'en' : 'fr'
}

const resources = {
  fr: {
    translation: {
      appName: 'OpsHub',
      common: {
        error: 'Erreur',
        dash: '—',
        none: 'Aucun',
        ip: 'IP',
        optional: '(optionnel)',
        optionalShort: '(opt)',
        refresh: 'Rafraîchir',
        save: 'Enregistrer',
        cancel: 'Annuler',
        delete: 'Supprimer',
        edit: 'Modifier',
        actions: 'Actions',
        loading: 'chargement',
        yes: 'Oui',
        no: 'Non',
        confirm: 'Confirmer',
        create: 'Créer',
      },
      nav: {
        dashboard: 'Dashboard',
        kanban: 'Kanban',
        calendar: 'Calendrier',
        ansible: 'Ansible',
        server: 'Serveur',
        admin: 'Admin',
        profile: 'Profil',
        logout: 'Déconnexion',
        theme: 'Thème',
      },
      theme: {
        dark: 'Dark',
        bright: 'Brillant',
      },
      auth: {
        loginTitle: 'Connexion',
        loginSubtitle: 'Accès à OpsHub',
        email: 'Email',
        password: 'Mot de passe',
        loginAction: 'Se connecter',
        loginFailed: 'Connexion échouée',
        registerTitle: 'Créer un compte',
        registerSubtitle: 'Rejoindre OpsHub',
        firstName: 'Prénom',
        lastName: 'Nom',
        jobTitle: 'Poste',
        phone: 'Téléphone',
        age: 'Âge',
        createAccount: 'Créer',
        registerAction: 'Créer',
        haveAccount: 'Déjà un compte ?',
        noAccount: 'Pas de compte ?',
        goRegister: 'Créer un compte',
        goLogin: 'Se connecter',
        adminDefault: 'Admin par défaut',
      },
      dashboard: {
        tickets: 'Tickets',
        noTickets: 'Aucun ticket.',
        tasksToday: 'Tâches aujourd’hui',
        noTasksToday: 'Aucune tâche aujourd’hui.',
        pipelineStatus: 'Statut pipeline',
        loadError: 'Erreur de chargement Dashboard',
      },
      kanban: {
        title: 'Pipeline & Tâches (Kanban)',
        refresh: 'Rafraîchir',
        empty: 'Vide',
        todo: 'À faire',
        inProgress: 'En cours',
        done: 'Fait',
        estimate: 'Est',
        gitlabMr: 'GitLab MR',
        gitlabJob: 'GitLab Job',
        note: "Note: drag&drop UI arrive dans l’itération suivante; la mise à jour est déjà câblée via l’API.",
      },
      calendar: {
        createEvent: 'Créer un événement',
        editEvent: 'Modifier un événement',
        title: 'Titre',
        allDay: 'Toute la journée',
        start: 'Début',
        end: 'Fin',
        group: 'Groupe',
        description: 'Description',
        groupRestricted: 'Assignation groupe limitée (admin/chef de projet).',
        create: 'Créer',
        save: 'Enregistrer',
        delete: 'Supprimer',
        confirmDeleteEvent: 'Supprimer cet événement ?',
        hint: 'Astuce: vous pouvez aussi déplacer/redimensionner dans le calendrier.',
        upcoming: 'Prochains événements',
        none: 'Aucun',
        stats: 'Stats',
        totalVisible: 'Total visible',
        myEvents: 'Mes événements',
        role: 'Rôle',
      },
      profile: {
        title: 'Mon profil',
        updated: 'Profil mis à jour',
        notAuthenticated: 'Non authentifié',
        verifyEmail: 'Vérifier mon email',
        verifyHelp: 'La vérification email est requise pour créer des RDV (sauf ADMIN).',
        requestSent: 'Demande envoyée (best-effort).',
        emailVerified: 'Email vérifié',
        active: 'Actif',
        group: 'Groupe',
        role: 'Rôle',
      },
      admin: {
        accessRequired: 'Accès admin requis',
        usersTitle: 'Administration · Utilisateurs',
        createUser: 'Créer un utilisateur',
        search: 'Recherche',
        searchPlaceholder: 'email / nom',
        name: 'Nom',
        role: 'Rôle',
        group: 'Groupe',
        active: 'Actif',
        edit: 'Éditer',
        selectUser: 'Sélectionnez un utilisateur.',
        emailVerified: 'Email vérifié',
        newPasswordOptional: 'Nouveau mot de passe (optionnel)',
        confirmDeleteUser: 'Supprimer cet utilisateur ?',
      },
      ansible: {
        title: 'Ansible',
        howItWorks: "Ce module analyse un fichier inventory Ansible (ini/yaml) stocké sous UPLOADS_PATH. Il lit les groupes/hôtes et renvoie un aperçu (JSON) — aucun playbook n’est exécuté. Le chemin doit rester dans le dossier uploads pour des raisons de sécurité.",
        inventoryPath: 'Chemin inventory (sous UPLOADS_PATH)',
        inventoryPlaceholder: 'ex: inventory.ini ou dossiers/...',
        inventoryHelp: 'L’API refuse les chemins hors du répertoire uploads.',
        analyze: 'Analyser',
        inventory: 'Inventory',
        noHosts: 'Aucun hôte',
        name: 'Nom',
      },
      server: {
        title: 'Monitoring serveur',
        targets: 'Cibles',
        host: 'IP / Hostname',
        name: 'Nom',
        nameOptional: 'Nom (optionnel)',
        add: 'Ajouter',
        noTargets: 'Aucune cible.',
        status: 'Statut',
        reachable: 'Accessible',
        unreachable: 'Injoignable',
        method: 'Méthode',
        collectedAt: 'Collecté',
        sshHint: 'Astuce: pour collecter CPU/RAM/Disque via SSH, définissez OPSHUB_SSH_USER et OPSHUB_SSH_KEY_PATH côté serveur.',
        confirmDelete: 'Supprimer cette cible ?'
        ,
        cpu: 'CPU',
        cores: 'Cœurs',
        load: 'Load',
        memory: 'Mémoire',
        total: 'Total',
        used: 'Utilisée',
        available: 'Disponible',
        storage: 'Stockage',
        path: 'Path',
        free: 'Libre',
      },
    },
  },
  en: {
    translation: {
      appName: 'OpsHub',
      common: {
        error: 'Error',
        dash: '—',
        none: 'None',
        ip: 'IP',
        optional: '(optional)',
        optionalShort: '(opt)',
        refresh: 'Refresh',
        save: 'Save',
        cancel: 'Cancel',
        delete: 'Delete',
        edit: 'Edit',
        actions: 'Actions',
        loading: 'loading',
        yes: 'Yes',
        no: 'No',
        confirm: 'Confirm',
        create: 'Create',
      },
      nav: {
        dashboard: 'Dashboard',
        kanban: 'Kanban',
        calendar: 'Calendar',
        ansible: 'Ansible',
        server: 'Server',
        admin: 'Admin',
        profile: 'Profile',
        logout: 'Logout',
        theme: 'Theme',
      },
      theme: {
        dark: 'Dark',
        bright: 'Bright',
      },
      auth: {
        loginTitle: 'Login',
        loginSubtitle: 'Access OpsHub',
        email: 'Email',
        password: 'Password',
        loginAction: 'Sign in',
        loginFailed: 'Login failed',
        registerTitle: 'Create account',
        registerSubtitle: 'Join OpsHub',
        firstName: 'First name',
        lastName: 'Last name',
        jobTitle: 'Job title',
        phone: 'Phone',
        age: 'Age',
        createAccount: 'Create',
        registerAction: 'Create',
        haveAccount: 'Already have an account?',
        noAccount: "No account?",
        goRegister: 'Create an account',
        goLogin: 'Sign in',
        adminDefault: 'Default admin',
      },
      dashboard: {
        tickets: 'Tickets',
        noTickets: 'No tickets.',
        tasksToday: 'Tasks today',
        noTasksToday: 'No tasks today.',
        pipelineStatus: 'Pipeline status',
        loadError: 'Dashboard load error',
      },
      kanban: {
        title: 'Pipeline & Tasks (Kanban)',
        refresh: 'Refresh',
        empty: 'Empty',
        todo: 'To do',
        inProgress: 'In progress',
        done: 'Done',
        estimate: 'Est',
        gitlabMr: 'GitLab MR',
        gitlabJob: 'GitLab Job',
        note: 'Note: drag&drop UI comes next iteration; updates already work via API.',
      },
      calendar: {
        createEvent: 'Create event',
        editEvent: 'Edit event',
        title: 'Title',
        allDay: 'All day',
        start: 'Start',
        end: 'End',
        group: 'Group',
        description: 'Description',
        groupRestricted: 'Group assignment restricted (admin/project lead).',
        create: 'Create',
        save: 'Save',
        delete: 'Delete',
        confirmDeleteEvent: 'Delete this event?',
        hint: 'Tip: you can also drag/resize in the calendar.',
        upcoming: 'Upcoming events',
        none: 'None',
        stats: 'Stats',
        totalVisible: 'Total visible',
        myEvents: 'My events',
        role: 'Role',
      },
      profile: {
        title: 'My profile',
        updated: 'Profile updated',
        notAuthenticated: 'Not authenticated',
        verifyEmail: 'Verify my email',
        verifyHelp: 'Email verification is required to create meetings (except ADMIN).',
        requestSent: 'Request sent (best-effort).',
        emailVerified: 'Email verified',
        active: 'Active',
        group: 'Group',
        role: 'Role',
      },
      admin: {
        accessRequired: 'Admin access required',
        usersTitle: 'Admin · Users',
        createUser: 'Create user',
        search: 'Search',
        searchPlaceholder: 'email / name',
        name: 'Name',
        role: 'Role',
        group: 'Group',
        active: 'Active',
        edit: 'Edit',
        selectUser: 'Select a user.',
        emailVerified: 'Email verified',
        newPasswordOptional: 'New password (optional)',
        confirmDeleteUser: 'Delete this user?',
      },
      ansible: {
        title: 'Ansible',
        howItWorks: 'This module analyzes an Ansible inventory file (ini/yaml) stored under UPLOADS_PATH. It reads groups/hosts and returns a preview (JSON) — no playbook is executed. The path must stay inside uploads for security reasons.',
        inventoryPath: 'Inventory path (under UPLOADS_PATH)',
        inventoryPlaceholder: 'e.g. inventory.ini or folders/...',
        inventoryHelp: 'API rejects paths outside uploads directory.',
        analyze: 'Analyze',
        inventory: 'Inventory',
        noHosts: 'No hosts',
        name: 'Name',
      },
      server: {
        title: 'Server monitoring',
        targets: 'Targets',
        host: 'IP / Hostname',
        name: 'Name',
        nameOptional: 'Name (optional)',
        add: 'Add',
        noTargets: 'No targets.',
        status: 'Status',
        reachable: 'Reachable',
        unreachable: 'Unreachable',
        method: 'Method',
        collectedAt: 'Collected',
        sshHint: 'Tip: to collect CPU/RAM/Disk via SSH, set OPSHUB_SSH_USER and OPSHUB_SSH_KEY_PATH on the server.',
        confirmDelete: 'Delete this target?'
        ,
        cpu: 'CPU',
        cores: 'Cores',
        load: 'Load',
        memory: 'Memory',
        total: 'Total',
        used: 'Used',
        available: 'Available',
        storage: 'Storage',
        path: 'Path',
        free: 'Free',
      },
    },
  },
} as const

void i18n.use(initReactI18next).init({
  resources,
  lng: initialLang(),
  fallbackLng: 'fr',
  supportedLngs: ['fr', 'en'],
  interpolation: { escapeValue: false },
})

i18n.on('languageChanged', (lng) => {
  if (lng === 'fr' || lng === 'en') localStorage.setItem(STORAGE_KEY, lng)
})

export default i18n
